# Tourgether 개발자 지도(쉬운 버전)
우섭이 바로 이해하고, 바로 고칠 수 있게 "쉽게" 풀어쓴 사용설명서. 어려운 단어는 친절하게 비유로 설명합니다. (Replit이 뭘 바꿔도 이 문서만 보면 길 안 잃어요.)

---

## 0) 이 앱의 큰 그림 (한 장 요약)
- **클라이언트(client/)**: 앱 화면. 버튼, 지도, 채팅창 같은 것들. (사용자 눈에 보이는 부분)
- **서버(server/)**: 요청을 받아서 DB에서 꺼내오고 저장하고, 실시간 메시지도 뿌려주는 곳. (뒤에서 일하는 부분)
- **공통(shared/)**: 클라와 서버가 같이 쓰는 "데이터 규칙"과 "표 구조(스키마)".

흐름 비유:  
> **클라**는 식당의 손님, **서버**는 주방, **DB**는 창고.  
> 손님이 "비빔밥 주세요(요청)" → 주방이 창고에서 재료를 꺼내 요리(서버+DB) → 손님에게 서빙(응답).

---

## 1) 자주 나오는 용어, 초간단 사전
- **API**: 앱끼리 약속한 "주문서 포맷". 예) `/api/auth/login`은 "로그인 주문서" 창구.
- **토큰(Token)**: "출입증/통행증". 로그인에 성공하면 서버가 한 장 발급해주고, 이후 주문서에 붙여서 "나 인증된 사람이에요"라고 증명.
- **JWT**: 토큰의 한 종류. 안에 "누구인지, 언제까지 유효한지"가 적혀 있고 위조 방지 서명이 붙어 있는 출입증.
- **로컬스토리지(LocalStorage)**: 브라우저 안의 작은 서랍. 토큰 같은 걸 잠깐 넣어 둠. (로그아웃하면 버리면 됨)
- **Express(익스프레스)**: 서버 만드는 프레임워크. "이 주소로 오면 이런 요리를 해줘"를 쉽게 적는 틀.
- **WebSocket(웹소켓)**: "계속 연결된 전화선" 같은 통신. 일반 API(HTTP)가 "택배 한 번 보내고 끊음"이라면, WebSocket은 "전화 중 실시간 대화". → 채팅/알림에 사용.
- **DB(데이터베이스)**: 표로 된 저장소. 사용자/글/메시지 등 기록을 저장.
- **스키마(Schema)**: 표 설계도. 어떤 칸(열)이 있고, 무슨 타입인지.
- **모달/팝업(Modal)**: 화면 위에 뜨는 작은 창. 로그인창, 글쓰기창 같은 것.
- **파라미터(Parameters)**: API에 건네는 재료들. 예) 로그인 파라미터는 `{email, password}`.

---

## 2) 우리 폴더 구조, 무엇이 어디에 있나
### 2-1. client/ (화면)
- **pages/**: 각 화면 페이지.
  - `home.tsx` 홈
  - `map.tsx` 지도
  - `feed.tsx` 피드 목록
  - `timeline.tsx` 여행 타임라인 보기
  - `TimelineCreate.tsx` 미디어 가져와서 타임라인 만들기
  - `chat.tsx` 채팅
  - `admin.tsx` 관리자용 목록
  - `landing.tsx` 데모 로그인
  - `profile.tsx` 내 프로필("오픈투밋" 스위치)
- **components/**: 화면 조각(버튼, 카드, 지도, 모달 등)
  - `LoginModal.tsx` 로그인 모달 → 로그인 API 호출
  - `CreatePostModal.tsx` 글쓰기 모달 → 포스트 작성 API 호출
  - `BookingModal.tsx` 예약 모달(가이드 경험 예약)
  - `MapComponent.tsx` 지도, 마커 표시, 미니밋 목록 불러오기
  - `ChatWindow.tsx` 채팅창(메시지 보내기/받기)
  - `NotificationBell.tsx` 알림 종
- **hooks/**: 자주 쓰는 로직 묶음
  - `useAuth.ts` 로그인 상태 관리(토큰 있으면 내 정보 불러오기)
  - `useWebSocket.ts` 서버와 "전화선(WebSocket)" 연결해서 실시간 메시지 받기
- **lib/api.ts**: API 호출 도우미(토큰 자동 첨부)

### 2-2. server/ (뒤에서 일하는 주방)
- **index.ts**: 서버 시작점. 보안 설정(헬멧), 속도 제한, 라우터 등록 등.
- **routes.ts**: 메인 길(주소와 처리기). 예) `/api/auth/login` 처리, 파일 다운로드 프록시 등.
- **routes/trips.ts**: 사진/동영상 가져와서 EXIF(촬영일/위치) 읽고, 타임라인으로 묶어주는 처리.
- **storage.ts**: DB에 실제로 읽고/쓰기("창고 관리자"). 예) `createMessage()`, `getTimelines()` 등.
- **auth.ts**: 로그인/암호화/토큰 발급·검증.
- **replitAuth.ts**: Replit 계정으로 로그인할 때 쓰는 부가 모듈.

### 2-3. shared/ (서로 공유하는 설계도)
- **schema.ts**: DB 표 구조(사용자, 글, 댓글, 메시지, 예약, 미니밋 등 전부)
- **api/schema.ts**: 각 API가 받는 파라미터의 규칙(예: 로그인은 이메일+패스워드가 꼭 있어야 함)

---

## 3) "누가, 언제, 무엇을" 하는지 – 쉬운 흐름 시나리오
### 3-1. 로그인 시나리오
1) 화면에서 **로그인 모달** 열기 → 이메일/비밀번호 입력 → **버튼 클릭**
2) 브라우저가 **`POST /api/auth/login`** 로 주문(이메일·비밀번호) 발송
3) 서버가 맞다면 **토큰(출입증)** 을 만들어 **응답**
4) 화면이 그 토큰을 **로컬스토리지(서랍)** 에 넣어둠
5) 다음부터 API 호출할 때 자동으로 **출입증을 들고 감** (서버가 "아 이 사람 인증됨" 하고 통과)

### 3-2. 글 쓰기(포스트)
1) **글쓰기 모달** 열기 → 내용/사진 선택 → 저장
2) **`POST /api/posts`** 로 주문 발송
3) 서버가 DB에 저장 → 성공 응답
4) 화면이 새로고침 없이 목록에 **바로 추가**

### 3-3. 채팅
1) 앱 들어오면 **WebSocket(전화선)** 연결 시도
2) 연결되면 **"나 인증됨"** 신호를 보냄(토큰 기반 추천)
3) 내가 메시지 보내면 → 서버가 DB에 저장 → 상대방이 온라인이면 그 사람에게 **바로 푸시**
4) 상대방이 없으면, 다음에 들어올 때 목록에서 확인(알림 데이터도 DB에 저장되어 있음)

### 3-4. 타임라인 만들기
1) 사진/동영상을 **불러오기** → **`POST /api/trips/import-media`** 로 업로드
2) 서버가 EXIF(찍은 날짜/위치) 확인 → 같은 날끼리 묶어서 "1일차/2일차…"
3) 화면이 "여정 타임라인" 형태로 보여줌

---

## 4) "메시지는 누가 뿌리나? DB는 누가 만지나? 팝업은 누가 띄우나?"
- **메시지 뿌리는 주체(실시간)**: `server/routes.ts` 내부의 WebSocket 핸들러.  
  전화선이 연결되어 있으면, 새 메시지가 DB에 저장된 즉시 상대방에게 "띠링!" 보내줌.
- **DB를 직접 만지는 곳**: `server/storage.ts` (읽기/쓰기 전부 이 파일 통해서)
- **팝업(모달)을 띄우는 곳**: `client/src/components/*Modal.tsx`  
  예) 로그인은 `LoginModal.tsx`, 글쓰기는 `CreatePostModal.tsx`.

---

## 5) 실제 주소(API)와 파라미터 (쉬운 설명)
> **요청 형식**: `POST /api/무엇` + 필요한 재료(파라미터)

- **로그인** `POST /api/auth/login`  
  재료: `{ email, password }`  
  결과: `{ token: '출입증문자열', user: {...} }`

- **회원가입** `POST /api/auth/register`  
  재료: `{ email, password, nickname }` (등)

- **내 정보** `GET /api/auth/me`  
  재료: (없음)  
  단, **헤더에 토큰** 들고 가야 함 → 서버가 "누군지" 알게 됨

- **포스트 만들기** `POST /api/posts`  
  재료: `{ content, images[] }`

- **타임라인 목록** `GET /api/timelines`  
  재료: (없음)

- **미디어 임포트** `POST /api/trips/import-media`  
  재료: 업로드 파일들(사진/동영상)

- **미니밋 목록** `GET /api/mini-meets`

- **오픈투밋 토글** `PATCH /api/profile/open`  
  재료: `{ open: true | false }`

- **채팅(실시간)**: HTTP가 아니라 **WebSocket**으로 보냄  
  예) 전화선을 먼저 연결하고, 이런 메시지를 보냄:  
  `{ type: 'send_message', conversationId, recipientId, content }`

---

## 6) "어려운 부분 최소화"를 위한 안전 가이드
- **토큰이란?** 로그인 성공하면 받는 "출입증". 이후 주문할 때 항상 함께 보냄.  
  (도둑맞지 않게 XSS 같은 보안만 주의 → 추후 HttpOnly 쿠키로 바꾸면 더 안전)
- **WebSocket과 Express를 왜 같이 쓰나?**  
  - Express = 택배(요청/응답 한 번으로 끝나는 것들: 로그인, 글쓰기, 목록 보기)
  - WebSocket = 전화(계속 연결: 채팅/알림처럼 즉시 반응해야 하는 것)
- **이미지 주소**는 `/api/files/파일명` 형태로 쓰면 안전.  
  (직접 `/uploads/파일명`으로 때리면 보안상 좋지 않음)
- **DB를 건드리는 코드**는 `storage.ts` 안에 모아두자.  
  (이 파일만 보면 "어디에 무엇을 저장/수정"하는지 전체를 파악 가능)

---

## 7) 오늘 바로 할 수 있는 체크리스트 (쉬운 말로)
1) **채팅 전화선 보안 강화**: 전화선 연결할 때 "출입증(JWT)"도 같이 보내고, 서버에서 진짜 본인인지 확인하도록 바꾸기.
2) **이미지 경로 정리**: 화면에서 `/uploads/`로 직접 보지 말고 `/api/files/`로 보기.
3) **전화선 주소 고정값 없애기**: `:5000` 같은 숫자 하드코딩 제거하고, 현재 접속한 도메인을 자동 사용.
4) **구글 로그인 유령 코드 지우기**: 없는 파일을 가져오는 코드가 있으면 주석 처리.
5) **사진 EXIF 개인정보 제거**: 위치 같은 민감 정보가 노출되지 않게 저장 시 제거.

---

## 8) "어디를 보면 무엇을 알 수 있나" 요약표
- **화면이 뭘 부르는지 궁금** → `client/pages/*` 파일 열어서 `fetch(`/api/...`)`나 `api(`/api/...`)` 찾기
- **팝업이 뭘 하는지 궁금** → `client/components/*Modal.tsx`
- **실시간 알림/채팅 경로 궁금** → `client/hooks/useWebSocket.ts` + `server/routes.ts`(WebSocket 부분)
- **DB에 어떤 표가 있는지 궁금** → `shared/schema.ts`
- **API가 어떤 재료를 받는지 궁금** → `shared/api/schema.ts`
- **DB를 누가 만지는지 궁금** → `server/storage.ts`

---

## 9) 마지막으로: 정말 짧은 비유 한 줄 요약
- **Express(서버)** = 택배 회사  
- **WebSocket(실시간)** = 전화선  
- **API** = 주문서  
- **토큰** = 출입증  
- **DB** = 창고  
- **스키마** = 창고 도면  
- **모달** = 계산대 앞 작은 창

---

필요하면 이 문서를 더 쪼개서 "로그인만", "채팅만" 같은 **미니 가이드**로도 만들어 줄게. 다음에 어느 부분이 막혔는지 딱 말해주면, 그 파트만 확대해서 그림+화살표로 설명해 줄게!